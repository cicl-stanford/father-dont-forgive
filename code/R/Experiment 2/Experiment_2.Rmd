---
title: "Responsibility for Not Wanting To Know"
author: "Lara Kirfel, Xenia Bunk, Ro'i Zultan & Tobias Gerstenberg"
date: '`r format(Sys.Date(), "%B %d, %Y")`'
output:
  bookdown::html_document2:
    toc: true
    toc_depth: 4
    toc_float: true
    theme: cosmo
    highlight: tango
---

# Load packages
```{r, message=FALSE, warning=FALSE}

library("dplyr")
library("tidyverse")
library("tibble")
library("pwr")
library("car")
library("brms")  
library("knitr")       # for RMarkdown commands 
library("kableExtra")  # for nice tables
```

```{r}
# set ggplot theme 
theme_set(theme_classic())

# set knitr options
opts_chunk$set(comment = "",
               fig.show = "hold")

# suppress summarise() grouping warning 
options(dplyr.summarise.inform = F)
```

# Experiment 2: Manipulating Ignorance
## Read in data 

```{r}
# # Read in demographics data
# # Read data
participants2 <- read.csv(file="willful_ignorance_full_study_2-participants.csv") %>% 
  select(-c(proliferate.condition, error))

participants3 <- read.csv(file="willful_ignorance_full_study_3-participants.csv") %>% 
  select(-c(proliferate.condition, error))

# # Read in response data

responses2 <- read.csv(file="willful_ignorance_full_study_2-responses.csv") %>% 
  select(-c(proliferate.condition, error))

responses3 <- read.csv(file="willful_ignorance_full_study_3-responses.csv") %>% 
  select(-c(proliferate.condition, error, 
            ignorance_scenario1, ignorance_scenario2, 
            ignorance_scenario1_response_counterfactual,
            ignorance_scenario2_response_counterfactual))


# # Merge datafiles
Data2a.df <- merge(responses2, participants2, by="workerid") 
Data2b.df <- merge(responses3, participants3, by="workerid") 
Data2a.df$uncertainty <- "medium"
Data2b.df$uncertainty <- "high"
Data2.df <- rbind(Data2a.df, Data2b.df) 
```

# Edit Data

```{r}
# # New columns with condition information 
Exp2.df <- Data2.df  %>% 
  gather("index", "value", -c(workerid, condition, age, ethnicity, gender, feedback, race, uncertainty))%>% 
  mutate(scenario_order  =
           case_when(
             str_detect(index, "1") ~ "1",
             str_detect(index, "2") ~ "2",
             str_detect(index, "3") ~ "3",
             str_detect(index, "4") ~ "4",
           )) %>% 
mutate(index =
         case_when(
           str_detect(index, "_response_first") ~ "responsibility_rating",
           str_detect(index, "_response_second") ~ "belief_rating",
           str_detect(index, "scenario") ~ "scenario") ## order important, do not change
         ) %>% 
spread(index, value) %>%
mutate(EpistemicCondition  =
           case_when(
        condition == "condition1" & scenario ==  "sunscreen"~ "Willful\nIgnorance",
        condition == "condition1" & scenario ==  "laundry"~ "Unintentional\nIgnorance",
        condition == "condition1" & scenario ==  "paint"~ "Willful\nKnowledge",
        condition == "condition1" & scenario ==  "fertilizer"~ "Unintentional\nKnowledge",
        condition == "condition2" & scenario ==  "sunscreen"~ "Unintentional\nKnowledge",
        condition == "condition2" & scenario ==  "laundry"~ "Willful\nKnowledge",
        condition == "condition2" & scenario ==  "paint"~ "Willful\nIgnorance",
        condition == "condition2" & scenario ==  "fertilizer"~ "Unintentional\nIgnorance",
        condition == "condition3" & scenario ==  "sunscreen"~ "Unintentional\nIgnorance",
        condition == "condition3" & scenario ==  "laundry"~ "Willful\nIgnorance",
        condition == "condition3" & scenario ==  "paint"~ "Unintentional\nKnowledge",
        condition == "condition3" & scenario ==  "fertilizer"~ "Willful\nKnowledge",
        condition == "condition4" & scenario ==  "sunscreen"~ "Willful\nKnowledge",
        condition == "condition4" & scenario ==  "laundry"~ "Unintentional\nKnowledge",
        condition == "condition4" & scenario ==  "paint"~ "Unintentional\nIgnorance",
        condition == "condition4" & scenario ==  "fertilizer"~ "Willful\nIgnorance")) %>% 
   mutate(EpistemicCondition= factor(EpistemicCondition, levels=c("Unintentional\nIgnorance", "Willful\nIgnorance",      "Unintentional\nKnowledge", "Willful\nKnowledge"))) %>% 
  mutate(Knowledge  =
         case_when(
           EpistemicCondition == "Willful\nIgnorance" |  EpistemicCondition == "Unintentional\nIgnorance" ~ "Ignorance",
           EpistemicCondition == "Willful\nKnowledge" |  EpistemicCondition == "Unintentional\nKnowledge" ~ "Knowledge")) %>% 
    mutate(Intentionality  =
             case_when(
               EpistemicCondition == "Willful\nIgnorance" |  EpistemicCondition == "Willful\nKnowledge" ~ "Intentional",
               EpistemicCondition == "Unintentional\nKnowledge" |  EpistemicCondition == "Unintentional\nIgnorance" ~ "Unintentional")) %>% 
    mutate(EpistemicCondition  =
         case_when(
           EpistemicCondition == "Willful\nIgnorance" ~ "WI",
           EpistemicCondition == "Unintentional\nIgnorance" ~ "UI",
           EpistemicCondition == "Willful\nKnowledge" ~ "WK",
           EpistemicCondition == "Unintentional\nKnowledge" ~ "UK")) %>% 
    mutate(EpistemicCondition= factor(EpistemicCondition, levels=c("UI", "WI", "UK", "WK"))) %>% 
    mutate(uncertainty, as.factor(uncertainty)) %>% 
    mutate(Uncertainty = recode_factor(uncertainty, 
                                medium = "Knowledge: 100%, Ignorance: 50%",
                                high = "Knowledge: 100%, Ignorance: 20%")) %>% 
    mutate(Intentionality= factor(Intentionality, 
                                  levels=c("Intentional", "Unintentional"))) %>% 
    mutate(responsibility_rating = as.numeric(responsibility_rating)) %>% 
    mutate(belief_rating = as.numeric(belief_rating)) 

```

#Demographics

```{r}
Data2_demo.df <-Data2.df%>% 
    summarise(n=n(),
             mean_age = mean(age, na.rm=TRUE),
             std_age=sd(age,na.rm=TRUE),
             female=sum(gender=="Female"),
             male=sum(gender=="Male"),
             non_binary=sum(gender=="Non-binary"),
             asian=sum(race=="Asian"),
             white=sum(race=="White"),
             black=sum(race=="Black/African American"),
             multi=sum(race=="Multiracial"),
             hawai=sum(race=="Native Hawaiian/Pacific Islander"),
             other=sum(race=="other_race")
             )

```

# Descriptives

```{r}
Data2_desc.df <-Exp2.df%>% 
  group_by(Knowledge, Intentionality) %>% 
  summarize(mean_resp = mean(responsibility_rating),
            sd_resp = sd(responsibility_rating),
            mean_belief = mean(belief_rating),
            sd_belief = sd(belief_rating))

```



#Analysis
## Setting contrasts
```{r}
contrasts(Exp2.df$Knowledge) = contr.sum(2)
contrasts(Exp2.df$Intentionality) = contr.sum(2)
```

## Responsibility Rating

```{r}
fit_responsibility_judgment = brm(formula = responsibility_rating ~  1 + Knowledge*Intentionality + (1 | workerid) + (1 | scenario),
                             data = Exp2.df,
                             seed = 1,
                             cores = 2,
                             file = "cache/fit_responsibility_judgment")

summary(fit_responsibility_judgment)
```

## Belief Rating

```{r}
fit_belief_judgment = brm(formula = belief_rating ~  1 + Knowledge*Intentionality + (1 | workerid) + (1 | scenario),
                                  data = Exp2.df,
                                  seed = 1,
                                  cores = 2,
                                 file = "cache/fit_belief_judgment"))

fit_belief_judgment
```

#Uncertainty
```{r}
Exp2b.df <- Exp2.df %>% 
  filter(Knowledge == "Ignorance") %>% 
  mutate(Uncertainty=as.factor(Uncertainty))

#set contrasts 
contrasts(Exp2b.df$Uncertainty) = contr.sum(2)
```

## Responsibility Judgement
```{r}

fit_responsibility_judgment_uncertain = brm(formula = responsibility_rating ~  1 + Uncertainty + (1 | workerid) + (1 | scenario),
                                  data = Exp2b.df,
                                  seed = 1,
                                  cores = 2,
                                  file = "cache/fit_responsibility_judgment")
)

fit_responsibility_judgment_uncertain
```
##  Belief Judgement
```{r}

fit_belief_judgment_uncertain = brm(formula = belief_rating ~  1 + Uncertainty + (1 | workerid) + (1 | scenario),
                                  data = Exp2b.df,
                                  seed = 1,
                                  cores = 2,
                                  file = "cache/fit_belief_judgment")

fit_belief_judgment_uncertain
```
# Counterfactual Analysis

### Create separate Dataframe
```{r}
responses3c <- read.csv(file="willful_ignorance_full_study_3-responses.csv") 

Data2c.df <- merge(responses3c, participants3, by="workerid") %>% 
  select(workerid:ignorance_scenario2_response_counterfactual) %>% 
  rename(response_counterfactual_1 = ignorance_scenario1_response_counterfactual) %>% 
  rename(response_counterfactual_2 = ignorance_scenario2_response_counterfactual)
  
```

### Edit Counterfactual Dataframe

```{r}
Exp2c.df <- Data2c.df  %>% 
  select(-c(proliferate.condition, condition)) %>% 
  pivot_longer(cols = starts_with("response"), names_to = "condition", names_prefix = "counterfactual", values_to = "counterfactual_rating") %>% 
  mutate(Intentionality = 
           case_when(
             condition == "response_counterfactual_1" & ignorance_scenario1 ==  "IntentionalIgnorance"~ "Intentional",
             condition == "response_counterfactual_1" & ignorance_scenario1 ==  "UnintentionalIgnorance"~ "Unintentional",
             condition == "response_counterfactual_2" & ignorance_scenario2 ==  "IntentionalIgnorance"~ "Intentional",
             condition == "response_counterfactual_2" & ignorance_scenario2 ==  "UnintentionalIgnorance"~ "Unintentional")
) %>% 
  mutate(Intentionality= factor(Intentionality, levels=c("Intentional", "Unintentional"))) %>% 
  mutate(counterfactual_rating = as.numeric(counterfactual_rating))
```

### Counterfactual Rating Analysis

```{r}
contrasts(Exp2c.df$Intentionality) = contr.sum(2)
```


```{r}
#### Counterfactual Rating

fit_counterfactual_judgment = brm(formula = counterfactual_rating ~  1 + Intentionality + (1 | workerid),
                                  data = Exp2c.df,
                                  seed = 1,
                                  cores = 2,
                                  file = "cache/fit_counterfactual_judgment")


summary(fit_counterfactual_judgment)
```




# Figures
## Set theme
```{r}

myTheme <-   theme(axis.title.x  = element_blank(), 
                   axis.title.y = element_text(color="black", size = 17, vjust=.9), 
                   axis.text.x = element_text(color="black", size = 16),
                   axis.text.y = element_text(color="black", size = 16), 
                   strip.text.x = element_text(color="black", size = 13),
                   legend.text = element_text(color="black", size = 12),
                   panel.grid.major = element_blank(),
                   panel.grid.minor = element_blank(),
                   strip.background = element_rect(fill="white"),
                   legend.title = element_blank()
)
```

## Figure Responsibility Ratings

```{r}
Fig2a <- Exp2.df %>% 
  ggplot(aes(x=EpistemicCondition, y=responsibility_rating, group=EpistemicCondition, fill=EpistemicCondition)) +
  coord_cartesian(ylim = c(0,10)) +
  scale_y_continuous(breaks = seq(0, 10, by=1))+
  stat_summary(fun = mean, geom = "bar", colour = "black", alpha=0.7) +
  stat_summary(fun.data = mean_cl_boot, geom = "linerange", width = 1, size=1) +
  geom_jitter(position = position_jitter(height = 0.2, width=0.15), alpha = 
                0.05, colour="black")+
  labs( y="Responsibility Rating")+
  scale_fill_brewer(palette="Paired")+
  guides(fill = FALSE, colour = FALSE)+
  facet_wrap(~Uncertainty)+
  theme_bw()+
  myTheme

#Show plot
plot(Fig2a)
ggsave(Fig2a, file="Fig2a.pdf", dpi=400, height = 5, width = 8)
```
## Figure Belief Ratings

```{r}
my_colors <- RColorBrewer::brewer.pal(12, "Paired")[5:8]


Fig2b <- Exp2.df %>% 
  ggplot(aes(x=EpistemicCondition, y=belief_rating, group=EpistemicCondition, fill=EpistemicCondition)) +
  coord_cartesian(ylim = c(0,10)) +
  scale_y_continuous(breaks = seq(0, 10, by=1))+
  stat_summary(fun = mean, geom = "bar", colour = "black", alpha=0.5) +
  stat_summary(fun.data = mean_cl_boot, geom = "linerange", width = 1, size=1) +
  geom_jitter(position = position_jitter(height = 0.2, width=0.15), alpha = 
                0.05, colour="black")+
  labs( y="Belief Rating")+
  scale_fill_manual(values=my_colors)+
  guides(fill = FALSE, colour = FALSE) +
  facet_wrap(~Uncertainty)+
  theme_bw()+
  myTheme

#Show plot
plot(Fig2b)

ggsave(Fig2b, file="Fig2b.pdf", dpi=400, height = 5, width = 8)
```
## Combined figures 

```{r, fig.width=8, fig.height=10}
Fig2a + Fig2b + 
  plot_layout(ncol = 1) + 
  plot_annotation(tag_levels = "A") & 
  theme(plot.tag = element_text(face = 'bold', size = 22))

ggsave(file="../../../figures/plots/experiment2.pdf",
       height = 8,
       width = 7)
```



